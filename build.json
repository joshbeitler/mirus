{
  "recipes": [
    {
      "name": "limine-header",
      "description": "Fetch latest Limine header from GitHub",
      "sources": [],
      "tools": {
        "fetch": {
          "cmd": "curl",
          "args": [
            "-Lo",
            "src/kernel/include/limine.h",
            "https://github.com/limine-bootloader/limine/raw/trunk/limine.h"
          ]
        }
      }
    },
    {
      "name": "ssf-header",
      "description": "Fetch latest Simple Screen Font 2.0 header from GitLab",
      "sources": [],
      "tools": {
        "fetch": {
          "cmd": "curl",
          "args": [
            "-Lo",
            "src/kernel/include/ssfn.h",
            "https://gitlab.com/bztsrc/scalable-font2/-/raw/master/ssfn.h?ref_type=heads"
          ]
        }
      }
    },
    {
      "name": "kernel",
      "description": "Build the kernel",
      "sources": ["src/kernel/**/*.c"],
      "dependencies": ["limine-header", "ssf-header"],
      "tools": {
        "compile": {
          "cmd": "clang",
          "args": [
            "-target",
            "x86_64-unknown-elf",
            "-Wall",
            "-Wextra",
            "-std=gnu11",
            "-ffreestanding",
            "-fno-stack-protector",
            "-fno-stack-check",
            "-fno-lto",
            "-fPIE",
            "-m64",
            "-mno-80387",
            "-mno-mmx",
            "-mno-sse",
            "-mno-sse2",
            "-mno-red-zone",
            "-I",
            "src/kernel/include",
            "-c",
            "{sources}",
            "-o",
            "{output_dir}/{output_file_stem}.o"
          ],
          "concurrent": true
        },
        "link": {
          "cmd": "ld.lld",
          "args": [
            "-m",
            "elf_x86_64",
            "-nostdlib",
            "-pie",
            "-z",
            "text",
            "-z",
            "max-page-size=0x1000",
            "-T",
            "meta/linker.ld",
            "{output_dir}/*.o",
            "-o",
            "{output_dir}/kernel"
          ]
        }
      }
    }
  ]
}
